---
# Delete NetworkPolicy
- name: "Delete NetworkPolicy"
  kubernetes.core.k8s:
    template: "{{ role_path }}/../../common_tasks/templates/backup_restore/network_policy.yml.j2"
    state: absent
    wait: true

# Delete Job
- name: "Delete Job"
  kubernetes.core.k8s:
    template: "{{ role_path }}/../../common_tasks/templates/backup_restore/copy_file_job.yml.j2"
    state: absent
    wait: true

# Delete Pod
- name: "Delete Pod"
  kubernetes.core.k8s:
    kind: Pod
    namespace: "{{ masbr_cp_namespace }}"
    label_selectors:
      - job-name = {{ masbr_cp_name }}
    state: absent
    wait: true

# Delete config file from pod
- name: "Delete config file from pod"
  shell: >
    oc exec {{ masbr_cp_pod_name }} -c {{ masbr_cp_container_name }} -n {{ masbr_cp_namespace }} -- bash -c
    'rm -f {{ masbr_cp_config_folder }}/rclone.conf'
