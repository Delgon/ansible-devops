---
- name: "Delete copying file resources"
  when: masbr_cf_k8s_name is defined and masbr_cf_k8s_name | length > 0
  block:
    - name: "Delete ConfigMap"
      kubernetes.core.k8s:
        kind: ConfigMap
        name: "{{ masbr_cf_k8s_name }}"
        namespace: "{{ masbr_cf_namespace }}"
        state: absent
        wait: true

    - name: "Delete Job"
      kubernetes.core.k8s:
        template: "{{ role_path }}/../../common_tasks/templates/backup_restore/copy_cloud_files_job.yml.j2"
        state: absent
        wait: true

    - name: "Delete Pod"
      kubernetes.core.k8s:
        kind: Pod
        namespace: "{{ masbr_cf_namespace }}"
        label_selectors:
          - job-name = {{ masbr_cf_k8s_name }}
        state: absent
        wait: true
