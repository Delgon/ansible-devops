---
# Copy job files from local storage to local job folder
# -----------------------------------------------------------------------------
- name: "Copy job files from local storage to local job folder"
  when: masbr_use_local_storage
  block:
    - name: "Set fact: local storage job folder"
      set_fact:
        masbr_storage_job_folder: "{{ masbr_storage_local_folder }}/{{ masbr_job_type }}s/{{ masbr_job_name }}"
      
    - name: "Debug: local storage job folder"
      debug:
        msg: "Local storage job folder .......... {{ masbr_storage_job_folder }}"

    - name: "Copy job files from local storage to local job folder"
      copy:
        src: "{{ masbr_storage_job_folder }}/{{ item }}"
        dest: "{{ masbr_local_job_folder }}/"
      loop: "{{ masbr_cp_paths }}"


# Copy job files from cloud storage to local job folder
# -----------------------------------------------------------------------------
- name: "Copy job files from cloud storage to local job folder"
  when: masbr_use_cloud_storage
  block:
    - name: "Set fact: cloud storage job folder"
      set_fact:
        masbr_storage_job_folder: >- 
          {{ masbr_storage_cloud_config }}:{{ masbr_storage_cloud_bucket }}/{{ masbr_job_type }}s/{{ masbr_job_name }}
      
    - name: "Debug: cloud storage job folder"
      debug:
        msg: "Cloud storage job folder .......... {{ masbr_storage_job_folder }}"

    - name: "Copy job files from cloud storage to local job folder"
      shell: >
        rclone --links --progress --no-check-certificate 
        copy {{ masbr_storage_job_folder }}/{{ item }} {{ masbr_local_job_folder }}
      register: _rclone_copy_output
      loop: "{{ masbr_cp_paths }}"


# Copy job files from pvc storage to local job folder
# -----------------------------------------------------------------------------
