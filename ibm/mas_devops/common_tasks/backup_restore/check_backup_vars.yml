---
# Check common variables
# -----------------------------------------------------------------------------
- name: "Check common variables"
  include_tasks: "{{ role_path }}/../../common_tasks/backup_restore/check_common_vars.yml"


# Check backup variables
# -----------------------------------------------------------------------------
- name: "Checks for incremental backup"
  when: masbr_backup_type == "incr"
  block:
    - name: "Fail if masbr_backup_from is not provided for incremental backup"
      assert:
        that: masbr_backup_from is defined and masbr_backup_from != ""
        fail_msg: "masbr_backup_from is required for incremental backup"

    - name: "Set fact: the Completed backup job name for masbr_backup_from"
      set_fact:
        masbr_backup_from_completed: "{{ masbr_backup_from }}-Completed"

    - name: "Check the existence of the backup job specified by masbr_backup_from_completed"
      include_tasks: "{{ role_path }}/../../common_tasks/backup_restore/list_storage_job_folders.yml"
      vars:
        - masbr_job_type: "backup"
        - masbr_ls_grep: "{{ masbr_backup_from_completed }}"

    - name: "Fail if not found a Completed backup job specified by masbr_backup_from_completed"
      assert:
        that: masbr_ls_results is defined and masbr_ls_results | length == 1
        fail_msg: "Not found the backup job folder: {{ masbr_storage_job_type_folder }}/{{ masbr_backup_from_completed }}"
