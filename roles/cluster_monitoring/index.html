<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/roles/cluster_monitoring/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>cluster_monitoring - MAS Devops Collection</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "cluster_monitoring";
        var mkdocs_page_input_path = "roles/cluster_monitoring.md";
        var mkdocs_page_url = "/ansible-devops/roles/cluster_monitoring/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS Devops Collection
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Playbooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/ocp/">OCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/cp4d/">Install Cloud Pak For Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-core/">Install Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-iot/">Add IoT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-manage/">Add Manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-monitor/">Add Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-optimizer/">Add Optimizer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-predict/">Add Predict</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-visualinspection/">Add Visual Inspection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-upgrade/">Upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/uninstall-core/">Uninstall Core</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: OCP Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_config/">ocp_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_deprovision/">ocp_deprovision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_efs/">ocp_efs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_github_oauth/">ocp_github_oauth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_login/">ocp_login</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_node_config/">ocp_node_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_provision/">ocp_provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_roks_upgrade_registry_storage/">ocp_roks_upgrade_registry_storage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_upgrade/">ocp_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_verify/">ocp_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Dependency Mgmt</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../appconnect/">appconnect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_bucket_access_point/">aws_bucket_access_point</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_documentdb_user/">aws_documentdb_user</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_policy/">aws_policy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_route53/">aws_route53</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_user_creation/">aws_user_creation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_vpc/">aws_vpc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager/">cert_manager</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">cluster_monitoring</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#role-variables">Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cluster_monitoring_action">cluster_monitoring_action</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cluster_monitoring_include_prometheus">cluster_monitoring_include_prometheus</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cluster_monitoring_include_grafana">cluster_monitoring_include_grafana</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cluster_monitoring_include_opentelemetry">cluster_monitoring_include_opentelemetry</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-prometheus">Role Variables - Prometheus</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_retention_period">prometheus_retention_period</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_storage_class">prometheus_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_storage_size">prometheus_storage_size</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_alertmgr_storage_class">prometheus_alertmgr_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_alertmgr_storage_size">prometheus_alertmgr_storage_size</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_userworkload_retention_period">prometheus_userworkload_retention_period</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_userworkload_storage_class">prometheus_userworkload_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prometheus_userworkload_storage_size">prometheus_userworkload_storage_size</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#role-variables-grafana">Role Variables - Grafana</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#grafana_major_version">grafana_major_version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grafana_v4_namespace">grafana_v4_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grafana_v5_namespace">grafana_v5_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grafana_instance_storage_class">grafana_instance_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grafana_instance_storage_size">grafana_instance_storage_size</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cis/">cis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../common_services/">common-services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configure_manage_eventstreams/">configure_manage_eventstreams</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos/">cos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos_bucket/">cos_bucket</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_admin_pwd_update/">cp4d_admin_pwd_update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d/">cp4d</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_service/">cp4d_service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2/">db2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_backup/">db2_backup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_restore/">db2_restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dro/">dro</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ibm_catalogs/">ibm_catalogs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kafka/">kafka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia_gpu/">nvidia_gpu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mongodb/">mongodb</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocs/">ocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sls/">sls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../turbonomic/">turbonomic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uds/">uds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Image Mirroring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_case_prepare/">mirror_case_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_extras_prepare/">mirror_extras_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_images/">mirror_images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_ocp/">mirror_ocp</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_contentsourcepolicy/">ocp_contentsourcepolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_simulate_disconnected_network/">ocp_simulate_disconnected_network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../registry/">registry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Suite Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_config/">suite_app_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_install/">suite_app_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_uninstall/">suite_app_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_upgrade/">suite_app_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_rollback/">suite_app_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_certs/">suite_certs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_config/">suite_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_db2_setup_for_manage/">suite_db2_setup_for_manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_dns/">suite_dns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install/">suite_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install_digest_cm/">suite_install_digest_cm</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_birt_report_config/">suite_manage_birt_report_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_bim_config/">suite_manage_bim_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_customer_files_config/">suite_manage_customer_files_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_doclinks_config/">suite_manage_doclinks_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_import_certs_config/">suite_manage_import_certs_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_load_dbc_scripts/">suite_manage_load_dbc_scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_logging_config/">suite_manage_logging_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_pvc_config/">suite_manage_pvc_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather/">suite_mustgather</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather_download/">suite_mustgather_download</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_uninstall/">suite_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_upgrade/">suite_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_rollback/">suite_rollback</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_verify/">suite_verify</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../convert_to_olm/">convert_to_olm</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ansible_version_check/">ansible_version_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../entitlement_key_rotation/">entitlement_key_rotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_jdbc/">gencfg_jdbc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_watsonstudio/">gencfg_watsonstudio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_workspace/">gencfg_workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_operator/">install_operator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_mongo/">gencfg_mongo</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS Devops Collection</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Roles: Dependency Mgmt</li>
      <li class="breadcrumb-item active">cluster_monitoring</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/roles/cluster_monitoring.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cluster_monitoring">cluster_monitoring<a class="headerlink" href="#cluster_monitoring" title="Permanent link"></a></h1>
<p>Configures an in-cluster monitoring stack for IBM Maximo Application Suite:</p>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.12/html/monitoring/enabling-monitoring-for-user-defined-projects">OpenShift user defined project monitoring</a> is enabled (<code>openshift-monitoring</code> namespace)</li>
<li><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.12/html/monitoring/index">OpenShift monitoring stack</a> is configured to use persistent storage (<code>openshift-monitoring</code> namespace)</li>
<li><a href="https://github.com/open-telemetry/opentelemetry-operator">OpenTelemetry operator</a> is installed (optional, <code>openshift-operators</code> namespace)</li>
<li><a href="https://grafana.com/">Grafana</a> installed using the <a href="https://github.com/grafana-operator/grafana-operator">community grafana operator</a> (<code>grafana</code> or <code>grafana5</code> namespace)</li>
</ul>
<p>The credentials for the grafana admin user are stored in <code>grafana-admin-credentials</code> secret in the grafana namespace. A route  is created in the grafana namespace to allow access to the grafana UI.</p>
<h2 id="role-variables">Role Variables<a class="headerlink" href="#role-variables" title="Permanent link"></a></h2>
<h3 id="cluster_monitoring_action">cluster_monitoring_action<a class="headerlink" href="#cluster_monitoring_action" title="Permanent link"></a></h3>
<p>Inform the role whether to perform an <code>install</code> or an <code>uninstall</code> of the cluster monitoring stack. Can also be set to <code>update_grafana</code> to update the Grafana Operator from V4 to V5.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using this role to upgrade from Grafana 4 to 5, the Grafana 5 instance will have a new URL and will not inherit the user database from the old v4 installation, the admin password will be new, and user accounts set up in the v4 instance will need to be recreated in the v5 instance.</p>
</div>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CLUSTER_MONITORING_ACTION</code></li>
<li>Default: <code>install</code></li>
</ul>
<h3 id="cluster_monitoring_include_prometheus">cluster_monitoring_include_prometheus<a class="headerlink" href="#cluster_monitoring_include_prometheus" title="Permanent link"></a></h3>
<p>By default this role will reconfigure Prometheus to enable persistent storage and user workload monitoring, this can be disabled by setting this variable to <code>False</code>.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CLUSTER_MONITORING_INCLUDE_PROMETHEUS</code></li>
<li>Default: <code>True</code></li>
</ul>
<h3 id="cluster_monitoring_include_grafana">cluster_monitoring_include_grafana<a class="headerlink" href="#cluster_monitoring_include_grafana" title="Permanent link"></a></h3>
<p>By default Grafana is included in the monitoring stack, this can be disabled by setting this variable to <code>False</code>.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CLUSTER_MONITORING_INCLUDE_GRAFANA</code></li>
<li>Default: <code>True</code></li>
</ul>
<h3 id="cluster_monitoring_include_opentelemetry">cluster_monitoring_include_opentelemetry<a class="headerlink" href="#cluster_monitoring_include_opentelemetry" title="Permanent link"></a></h3>
<p>By default OpenTelemtry is <strong>not</strong> included in the monitoring stack, this can be enabled by setting this variable to <code>True</code>.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CLUSTER_MONITORING_INCLUDE_OPENTELEMETRY</code></li>
<li>Default: <code>False</code></li>
</ul>
<h2 id="role-variables-prometheus">Role Variables - Prometheus<a class="headerlink" href="#role-variables-prometheus" title="Permanent link"></a></h2>
<h3 id="prometheus_retention_period">prometheus_retention_period<a class="headerlink" href="#prometheus_retention_period" title="Permanent link"></a></h3>
<p>Adjust the retention period for Prometheus metrics, only used when both <code>prometheus_storage_class</code> and <code>prometheus_alertmgr_storage_class</code> are set.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>PROMETHEUS_RETENTION_PERIOD</code></li>
<li>Default Value: <code>15d</code></li>
</ul>
<h3 id="prometheus_storage_class">prometheus_storage_class<a class="headerlink" href="#prometheus_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for Prometheus' metrics data persistent volume.</p>
<ul>
<li><strong>Required</strong> if one of the known supported storage classes is not installed in the cluster.</li>
<li>Environment Variable: <code>PROMETHEUS_STORAGE_CLASS</code></li>
<li>Default Value: <code>ibmc-file-gold-gid</code>, <code>ocs-storagecluster-cephfs</code>, <code>azurefiles-premium</code> (if available)</li>
</ul>
<h3 id="prometheus_storage_size">prometheus_storage_size<a class="headerlink" href="#prometheus_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used to store metrics, only used when both <code>prometheus_storage_class</code> and <code>prometheus_alertmgr_storage_class</code> are set.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>PROMETHEUS_STORAGE_SIZE</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="prometheus_alertmgr_storage_class">prometheus_alertmgr_storage_class<a class="headerlink" href="#prometheus_alertmgr_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for AlertManager's persistent volume.</p>
<ul>
<li><strong>Required</strong> if one of the known supported storage classes is not installed in the cluster.</li>
<li>Environment Variable: <code>PROMETHEUS_ALERTMGR_STORAGE_CLASS</code></li>
<li>Default Value: <code>ibmc-file-gold-gid</code>, <code>ocs-storagecluster-cephfs</code>, <code>azurefiles-premium</code> (if available)</li>
</ul>
<h3 id="prometheus_alertmgr_storage_size">prometheus_alertmgr_storage_size<a class="headerlink" href="#prometheus_alertmgr_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used by AlertManager, only used when both <code>prometheus_storage_class</code> and <code>prometheus_alertmgr_storage_class</code> are set.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>PROMETHEUS_ALERTMGR_STORAGE_SIZE</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="prometheus_userworkload_retention_period">prometheus_userworkload_retention_period<a class="headerlink" href="#prometheus_userworkload_retention_period" title="Permanent link"></a></h3>
<p>Adjust the retention period for User Workload Prometheus metrics, this parameter applies only to the User Workload Prometheus instance.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>PROMETHEUS_USERWORKLOAD_RETENTION_PERIOD</code></li>
<li>Default Value: <code>15d</code></li>
</ul>
<h3 id="prometheus_userworkload_storage_class">prometheus_userworkload_storage_class<a class="headerlink" href="#prometheus_userworkload_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for User Workload Prometheus' metrics data persistent volume.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>PROMETHEUS_USERWORKLOAD_STORAGE_CLASS</code></li>
<li>Default Value: <code>PROMETHEUS_STORAGE_CLASS</code></li>
</ul>
<h3 id="prometheus_userworkload_storage_size">prometheus_userworkload_storage_size<a class="headerlink" href="#prometheus_userworkload_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used to store User Workload metrics.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>PROMETHEUS_USERWORKLOAD_STORAGE_SIZE</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h2 id="role-variables-grafana">Role Variables - Grafana<a class="headerlink" href="#role-variables-grafana" title="Permanent link"></a></h2>
<h3 id="grafana_major_version">grafana_major_version<a class="headerlink" href="#grafana_major_version" title="Permanent link"></a></h3>
<p>Sets the major version of the grafana operator to install. <code>4</code> or <code>5</code></p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>GRAFANA_MAJOR_VERSION</code></li>
<li>Default Value: <code>5</code></li>
</ul>
<h3 id="grafana_v4_namespace">grafana_v4_namespace<a class="headerlink" href="#grafana_v4_namespace" title="Permanent link"></a></h3>
<p>Sets the namespace to install the grafana operator V4 and grafana instance</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>GRAFANA_NAMESPACE</code></li>
<li>Default Value: <code>grafana</code></li>
</ul>
<h3 id="grafana_v5_namespace">grafana_v5_namespace<a class="headerlink" href="#grafana_v5_namespace" title="Permanent link"></a></h3>
<p>Sets the namespace to install the grafana operator V5 and grafana instance</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>GRAFANA_V5_NAMESPACE</code></li>
<li>Default Value: <code>grafana5</code></li>
</ul>
<h3 id="grafana_instance_storage_class">grafana_instance_storage_class<a class="headerlink" href="#grafana_instance_storage_class" title="Permanent link"></a></h3>
<p>Declare the storage class for Grafana Instance user data persistent volume.</p>
<ul>
<li><strong>Required</strong> if one of the known supported storage classes is not installed in the cluster.</li>
<li>Environment Variable: <code>GRAFANA_INSTANCE_STORAGE_CLASS</code></li>
<li>Default Value: <code>ibmc-file-gold-gid</code>, <code>ocs-storagecluster-cephfs</code>, <code>azurefiles-premium</code> (if available)</li>
</ul>
<h3 id="grafana_instance_storage_size">grafana_instance_storage_size<a class="headerlink" href="#grafana_instance_storage_size" title="Permanent link"></a></h3>
<p>Adjust the size of the volume used to store Grafana user data.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>GRAFANA_INSTANCE_STORAGE_SIZE</code></li>
<li>Default Value: <code>10Gi</code></li>
</ul>
<h2 id="example-playbook">Example Playbook<a class="headerlink" href="#example-playbook" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  vars:
    prometheus_storage_class: &quot;ibmc-block-gold&quot;
    prometheus_alertmgr_storage_class: &quot;ibmc-file-gold-gid&quot;
    grafana_instance_storage_class: &quot;ibmc-file-gold-gid&quot;
    grafana_instance_storage_class: &quot;15Gi&quot;
  roles:
    - ibm.mas_devops.cluster_monitoring
</code></pre>
<p>To Upgrade from Grafana Operator from V4 to V5</p>
<pre><code class="language-yaml">- hosts: localhost
  vars:
    cluster_monitoring_action: &quot;update_grafana&quot;
  roles:
    - ibm.mas_devops.cluster_monitoring
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>note that the upgraded v5 grafana inherits the storage class and size from the v4 configuration unless they are defined as environment variables.</p>
</div>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link"></a></h2>
<p>EPL-2.0</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../cert_manager/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cis/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
