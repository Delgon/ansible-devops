<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/ansible-devops/roles/mongodb/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>mongodb - MAS Devops Collection</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "mongodb";
        var mkdocs_page_input_path = "roles/mongodb.md";
        var mkdocs_page_url = "/ansible-devops/roles/mongodb/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MAS Devops Collection
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../changes/">Changes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Playbooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/ocp/">OCP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-core/">Install Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-iot/">Add IoT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-manage/">Add Manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-monitor/">Add Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-optimizer/">Add Optimizer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-predict/">Add Predict</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-visualinspection/">Add Visual Inspection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-update/">Update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/oneclick-upgrade/">Upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../playbooks/uninstall-core/">Uninstall Core</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: OCP Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_deprovision/">ocp_deprovision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_disable_updates/">ocp_disable_updates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_github_oauth/">ocp_github_oauth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_login/">ocp_login</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_provision/">ocp_provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_roks_upgrade_registry_storage/">ocp_roks_upgrade_registry_storage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_upgrade/">ocp_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_verify/">ocp_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Dependency Mgmt</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../appconnect/">appconnect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_bucket_access_point/">aws_bucket_access_point</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_policy/">aws_policy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_user_creation/">aws_user_creation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aws_vpc/">aws_vpc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager/">cert_manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager_upgrade/">cert_manager_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cert_manager_upgrade_check/">cert_manager_upgrade_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cluster_monitoring/">cluster_monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cis/">cis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configure_manage_eventstreams/">configure_manage_eventstreams</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos/">cos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cos_bucket/">cos_bucket</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_admin_pwd_update/">cp4d_admin_pwd_update</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_hack_worker_nodes/">cp4d_hack_worker_nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d/">cp4d</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cp4d_service/">cp4d_service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2/">db2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_backup/">db2_backup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db2_restore/">db2_restore</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kafka/">kafka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia_gpu/">nvidia_gpu</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">mongodb</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#role-variables">Role Variables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_action">mongodb_action</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_ce_version">mongodb_ce_version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_namespace">mongodb_namespace</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_storage_class">mongodb_storage_class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_storage_capacity_data">mongodb_storage_capacity_data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_storage_capacity_logs">mongodb_storage_capacity_logs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_cpu_limits">mongodb_cpu_limits</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_mem_limits">mongodb_mem_limits</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_cpu_requests">mongodb_cpu_requests</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_mem_requests">mongodb_mem_requests</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_replicas">mongodb_replicas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_instance_id">mas_instance_id</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mas_config_dir">mas_config_dir</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#custom_labels">custom_labels</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-playbook">Example Playbook</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ca-certificate-renewal">CA Certificate Renewal</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#license">License</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocs/">ocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sbo/">sbo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sbo_upgrade/">sbo_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sls/">sls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uds/">uds</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Image Mirroring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_case_prepare/">mirror_case_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_extras_prepare/">mirror_extras_prepare</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_images/">mirror_images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mirror_ocp_release/">mirror_ocp_release</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_contentsourcepolicy/">ocp_contentsourcepolicy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ocp_simulate_disconnected_network/">ocp_simulate_disconnected_network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../registry/">registry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Suite Mgmt</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_config/">suite_app_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_install/">suite_app_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_app_upgrade/">suite_app_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_config/">suite_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_db2_setup_for_manage/">suite_db2_setup_for_manage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_dns/">suite_dns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install/">suite_install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_install_digest_cm/">suite_install_digest_cm</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_attachments_config/">suite_manage_attachments_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_birt_report_config/">suite_manage_birt_report_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_bim_config/">suite_manage_bim_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_customer_files_config/">suite_manage_customer_files_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_doclinks_config/">suite_manage_doclinks_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_import_certs_config/">suite_manage_import_certs_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_load_dbc_scripts/">suite_manage_load_dbc_scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_logging_config/">suite_manage_logging_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_manage_pvc_config/">suite_manage_pvc_config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather/">suite_mustgather</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_mustgather_download/">suite_mustgather_download</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_switch_to_olm/">suite_switch_to_olm</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_uninstall/">suite_uninstall</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_upgrade/">suite_upgrade</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../suite_verify/">suite_verify</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Roles: Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ansible_version_check/">ansible_version_check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_jdbc/">gencfg_jdbc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_watsonstudio/">gencfg_watsonstudio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gencfg_workspace/">gencfg_workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install_operator/">install_operator</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MAS Devops Collection</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Roles: Dependency Mgmt &raquo;</li>
      <li>mongodb</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/ansible-devops/blob/master/docs/roles/mongodb.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mongodb">mongodb<a class="headerlink" href="#mongodb" title="Permanent link"></a></h1>
<p><a href="https://github.com/mongodb/mongodb-kubernetes-operator">MongoDb CE operator</a> will be installed into the specified namespace, a 3 node cluster cluster will be created.  The cluster will bind six PVCs, these provide persistence for the data and system logs across the three nodes.  Currently there is no support built-in for customizing the cluster beyond this configuration.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The role will generate a yaml file containing the definition of a Secret and MongoCfg resource that can be used to configure the deployed instance as the MAS system MongoDb.</p>
<p>This file can be directly applied using <code>oc apply -f $MAS_CONFIG_DIR/mongocfg-mongoce-system.yaml</code> or used in conjunction with the <a href="../suite_config/">suite_config</a> role.</p>
</div>
<h2 id="role-variables">Role Variables<a class="headerlink" href="#role-variables" title="Permanent link"></a></h2>
<h3 id="mongodb_action">mongodb_action<a class="headerlink" href="#mongodb_action" title="Permanent link"></a></h3>
<p>Inform the role whether to perform an install or uninstall of MongoDb.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>MONGODB_ACTION</code></li>
<li>Default: <code>install</code></li>
</ul>
<h3 id="mongodb_ce_version">mongodb_ce_version<a class="headerlink" href="#mongodb_ce_version" title="Permanent link"></a></h3>
<p>Set the version of the MongoDb Community Edition Operator to install in the namespace.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>MONGODB_CE_VERSION</code></li>
<li>Default: <code>0.7.0</code></li>
</ul>
<h3 id="mongodb_namespace">mongodb_namespace<a class="headerlink" href="#mongodb_namespace" title="Permanent link"></a></h3>
<p>The namespace where the operator and MongoDb cluster will be deployed.</p>
<ul>
<li>Environment Variable: <code>MONGODB_NAMESPACE</code></li>
<li>Default Value: <code>mongoce</code></li>
</ul>
<h3 id="mongodb_storage_class">mongodb_storage_class<a class="headerlink" href="#mongodb_storage_class" title="Permanent link"></a></h3>
<p>Required.  The name of the storage class to configure the MongoDb operator to use for persistent storage in the MongoDb cluster.</p>
<ul>
<li>Environment Variable: <code>MONGODB_STORAGE_CLASS</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="mongodb_storage_capacity_data">mongodb_storage_capacity_data<a class="headerlink" href="#mongodb_storage_capacity_data" title="Permanent link"></a></h3>
<p>The size of the PVC that will be created for data storage in the cluster.</p>
<ul>
<li>Environment Variable: <code>MONGODB_STORAGE_CAPACITY_DATA</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="mongodb_storage_capacity_logs">mongodb_storage_capacity_logs<a class="headerlink" href="#mongodb_storage_capacity_logs" title="Permanent link"></a></h3>
<p>The size of the PVC that will be created for log storage in the cluster.</p>
<ul>
<li>Environment Variable: <code>MONGODB_STORAGE_CAPACITY_LOGS</code></li>
<li>Default Value: <code>20Gi</code></li>
</ul>
<h3 id="mongodb_cpu_limits">mongodb_cpu_limits<a class="headerlink" href="#mongodb_cpu_limits" title="Permanent link"></a></h3>
<p>The CPU limits on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_CPU_LIMITS</code></li>
<li>Default Value: <code>1</code></li>
</ul>
<h3 id="mongodb_mem_limits">mongodb_mem_limits<a class="headerlink" href="#mongodb_mem_limits" title="Permanent link"></a></h3>
<p>The Memory limits on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_MEM_LIMITS</code></li>
<li>Default Value: <code>1Gi</code></li>
</ul>
<h3 id="mongodb_cpu_requests">mongodb_cpu_requests<a class="headerlink" href="#mongodb_cpu_requests" title="Permanent link"></a></h3>
<p>The CPU requests on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_CPU_REQUESTS</code></li>
<li>Default Value: <code>500m</code></li>
</ul>
<h3 id="mongodb_mem_requests">mongodb_mem_requests<a class="headerlink" href="#mongodb_mem_requests" title="Permanent link"></a></h3>
<p>The Memory requests on the mongodb container.</p>
<ul>
<li>Environment Variable: <code>MONGODB_MEM_REQUESTS</code></li>
<li>Default Value: <code>1Gi</code></li>
</ul>
<h3 id="mongodb_replicas">mongodb_replicas<a class="headerlink" href="#mongodb_replicas" title="Permanent link"></a></h3>
<p>The number of the mongodb replica set members. Default is 3. Set to 1 for SNO Cluster.
- Environment Variable: <code>MONGODB_REPLICAS</code>
- Default Value: <code>3</code></p>
<h3 id="mas_instance_id">mas_instance_id<a class="headerlink" href="#mas_instance_id" title="Permanent link"></a></h3>
<p>The instance ID of Maximo Application Suite that the MongoCfg configuration will target.  If this or <code>mas_config_dir</code> are not set then the role will not generate a MongoCfg template.</p>
<ul>
<li>Environment Variable: <code>MAS_INSTANCE_ID</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="mas_config_dir">mas_config_dir<a class="headerlink" href="#mas_config_dir" title="Permanent link"></a></h3>
<p>Local directory to save the generated MongoCfg resource definition.  This can be used to manually configure a MAS instance to connect to the Mongo cluster, or used as an input to the <a href="../suite_config/">suite_config</a> role. If this or <code>mas_instance_id</code> are not set then the role will not generate a MongoCfg template.</p>
<ul>
<li>Environment Variable: <code>MAS_CONFIG_DIR</code></li>
<li>Default Value: None</li>
</ul>
<h3 id="custom_labels">custom_labels<a class="headerlink" href="#custom_labels" title="Permanent link"></a></h3>
<p>List of comma separated key=value pairs for setting custom labels on instance specific resources.</p>
<ul>
<li>Optional</li>
<li>Environment Variable: <code>CUSTOM_LABELS</code></li>
<li>Default Value: None</li>
</ul>
<h2 id="example-playbook">Example Playbook<a class="headerlink" href="#example-playbook" title="Permanent link"></a></h2>
<pre><code class="language-yaml">- hosts: localhost
  any_errors_fatal: true
  vars:
    mongodb_storage_class: ibmc-block-gold
    mas_instance_id: masinst1
    mas_config_dir: ~/masconfig
  roles:
    - ibm.mas_devops.mongodb
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the MongoDB CA Certificate expires the MongoDB replica set will become unusable. Replica set members will not be able to communicate with each other and client applications (i.e. Maximo Application Suite components) will not be to connect.</p>
</div>
<h2 id="ca-certificate-renewal">CA Certificate Renewal<a class="headerlink" href="#ca-certificate-renewal" title="Permanent link"></a></h2>
<p>In order to renew the CA Certificate used by the MongoDB replica set the following steps must be taken:</p>
<ul>
<li>Delete the CA Certificate resource</li>
<li>Delete the MongoDB server Certificate resource</li>
<li>Delete the Secrets resources associated with both the CA Certificate and Server Certificate</li>
<li>Delete the Secret resource which contains the MongoDB configuration parameters</li>
<li>Delete the ConfigMap resources which contains the CA certificate</li>
<li>Delete the Secret resource which contains the sever certificate and private key</li>
</ul>
<p>The following steps illustrate the process required to renew the CA Certificate, sever certificate and reconfigure the MongoDB replica set with the new CA and server certificates.</p>
<p>The first step is to stop the Mongo replica set and MongoDb CE Operator pod.</p>
<pre><code class="language-bash">#!/bin/bash

oc project mongoce

oc delete deployment mongodb-kubernetes-operator
oc delete statefulset mas-mongo-ce
</code></pre>
<p>Make sure all pods in the <code>mongoce</code> namespace have terminated and then execute the following to remove
the old Mongo configuration:</p>
<pre><code class="language-bash">oc delete certificate mongo-ca-crt
oc delete certificate mongo-server
oc delete secret mongo-ca-secret
oc delete secret mongo-server-cert

oc delete secret mas-mongo-ce-config
oc delete configmap  mas-mongo-ce-cert-map
oc delete secret mas-mongo-ce-server-certificate-key

export ROLE_NAME=mongodb
ansible-playbook ibm.mas_devops.run_role
</code></pre>
<p>Once the <code>mongodb</code> role has completed the MongoDb CE Operator pod and Mongo replica set should be configured.</p>
<p>After the CA and server Certificates have been renewed you must ensure that that MongoCfg Suite CR is updated with the new CA Certificate. First obtain the CA Certificate from the Secret resource <code>mongo-ca-secret</code>. Then edit the Suite MongoCfg CR in the Maximo Application Suite core namespace. This is done by updating the appropriate certificate under <code>.spec.certificates</code> in the MongoCfg CR:</p>
<pre><code class="language-yaml">  spec:
    certificates:
    - alias: ca
      crt: |
        -----BEGIN CERTIFICATE-----

        -----END CERTIFICATE-----

</code></pre>
<p>If an IBM Suite Licensing Service (SLS) is also connecting to the MongoDB replica set the LicenseService CR must also be updated to reflect the new MongoDB CA. This can be added to the <code>.spec.mongo.certificates</code> section of the LicenseService CR.</p>
<pre><code class="language-yaml">    mongo:
      certificates:
      - alias: mongoca
        crt: |
          -----BEGIN CERTIFICATE-----

          -----END CERTIFICATE-----
</code></pre>
<p>Once the CA certificate has been updated for the MongoCfg and LicenseService CRs several pods in the core and SLS namespaces might need to be restarted to pick up the changes. This would include but is not limited to coreidp, coreapi, api-licensing.</p>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link"></a></h2>
<p>EPL-2.0</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/ansible-devops" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../nvidia_gpu/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ocs/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
